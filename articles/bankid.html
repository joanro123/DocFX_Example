<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ActiveLogin.Authentication.BankId </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ActiveLogin.Authentication.BankId ">
    <meta name="generator" content="docfx 2.59.2.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="activeloginauthenticationbankid">ActiveLogin.Authentication.BankId</h1>

<p>ActiveLogin.Authentication enables an application to support Swedish BankID (svenskt BankID) authentication in .NET.</p>
<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#getting-started">Getting started</a>
<ul>
<li><a href="#1-preparation">1. Preparation</a></li>
<li><a href="#2-read-the-documentation">2. Read the documentation</a></li>
<li><a href="#3-install-the-nuget-package">3. Install the NuGet package</a></li>
<li><a href="#3-prepare-your-project">3. Prepare your project</a></li>
<li><a href="#4-get-started-in-development">4. Get started in development</a></li>
<li><a href="#5-use-test-or-production-environments">5. Use test or production environments</a></li>
<li><a href="#6-monitoring">6. Monitoring</a></li>
</ul>
</li>
<li><a href="#environments">Environments</a>
<ul>
<li><a href="#simulated-environment">Simulated environment</a></li>
<li><a href="#simulated-environment-with-no-config">Simulated environment with no config</a></li>
<li><a href="#simulated-environment-with-custom-person-info">Simulated environment with custom person info</a></li>
<li><a href="#test-environment">Test environment</a></li>
<li><a href="#production-environment">Production environment</a></li>
<li><a href="#full-sample-for-production">Full sample for production</a></li>
</ul>
</li>
<li><a href="#basic-configuration-samples">Basic configuration samples</a>
<ul>
<li><a href="#using-client-certificate-from-azure-keyvault">Using client certificate from Azure KeyVault</a></li>
<li><a href="#using-client-certificate-from-custom-source">Using client certificate from custom source</a></li>
<li><a href="#using-root-ca-certificate">Using root CA certificate</a></li>
<li><a href="#adding-schemas">Adding schemas</a></li>
<li><a href="#customizing-schemas">Customizing schemas</a></li>
<li><a href="#custom-schema">Custom schema</a></li>
<li><a href="#customizing-bankid-options">Customizing BankID options</a></li>
</ul>
</li>
<li><a href="#concepts">Concepts</a>
<ul>
<li><a href="#storing-certificates-in-azure">Storing certificates in Azure</a></li>
<li><a href="#bankid-claim-types">BankId claim types</a></li>
<li><a href="#bankid-certificate-policies">BankID Certificate Policies</a></li>
<li><a href="#return-url-for-cancellation">Return URL for cancellation</a></li>
<li><a href="#handle-missing-or-invalid-state-cookie">Handle missing or invalid state cookie</a></li>
<li><a href="#multi-tenant-scenario">Multi tenant scenario</a></li>
<li><a href="#customize-the-ui">Customize the UI</a></li>
<li><a href="#event-listeners">Event listeners</a></li>
<li><a href="#store-data-on-auth-completion">Store data on auth completion</a></li>
<li><a href="#resolve-the-end-user-ip">Resolve the end user ip</a></li>
<li><a href="#resolve-user-data-on-auth-request">Resolve user data on Auth request</a></li>
<li><a href="#custom-qr-code-generation">Custom QR code generation</a></li>
<li><a href="#custom-browser-detection-and-launch-info">Custom browser detection and launch info</a></li>
<li><a href="#use-api-wrapper-only">Use api wrapper only</a></li>
<li><a href="#running-on-linux">Running on Linux</a></li>
<li><a href="#localization">Localization</a></li>
<li><a href="#names-of-the-person-might-be-capitalized">Names of the person might be capitalized</a></li>
<li><a href="#cookies-issued">Cookies issued</a></li>
<li><a href="#browser-support">Browser support</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="getting-started">Getting started</h2>
<h3 id="1-preparation">1. Preparation</h3>
<h4 id="certificates">Certificates</h4>
<p>BankID requires you to use a client certificate and trust a specific root CA-certificate.</p>
<ol>
<li>Read through the <a href="https://www.bankid.com/utvecklare/guider">BankID Relying Party Guidelines</a>. This ensures you have a basic understanding of the terminology as well as how the flow and security works.</li>
<li>Download the SSL certificate for test (<a href="https://www.bankid.com/utvecklare/guider">FPTestcert2.pfx</a>).</li>
<li>Contact a <a href="https://www.bankid.com/foretag/anslut-foeretag">reseller</a> to get your very own client certificate for production. This will probably take a few business days to get sorted. Please ask for &quot;Direktupphandlad BankID&quot; as they otherwise might refer you to a broker/partner. If you haven't decided on using BankID, but want to try it out anyway there are test- and simulation possibilities. See Environments below.</li>
<li>The root CA-certificates specified in <em>BankID Relying Party Guidelines</em> (#7 for Production and #8 for Test environment) needs to be trusted at the computer where the app will run. Save those certificates as <code>BankIdRootCertificate-Prod.crt</code> and <code>BankIdRootCertificate-Test.crt</code>.
<ol>
<li>If running in Azure App Service, where trusting custom certificates <a href="https://azure.github.io/AppService/2021/06/22/Root-CA-on-App-Service-Guide.html">is not supported</a>, there are extensions available in our packages to handle that scenario. See documentation below. Instead of trusting the certificate, place it in your web project and make sure <code>CopyToOutputDirectory</code> is set to <code>Always</code>.</li>
<li>Add the following configuration values. The <code>FilePath</code> should point to the certificate you just added, for example:</li>
</ol>
</li>
</ol>
<pre><code class="lang-json">{
    &quot;ActiveLogin:BankId:CaCertificate:FilePath&quot;: &quot;Certificates\\BankIdRootCertificate-[Test or Prod].crt&quot;
}
</code></pre>
<p><em><strong>Note:</strong></em> When using MacOS or Linux, path strings use <code>'/'</code> for subfolders: <code>&quot;Certificates/BankIdRootCertificate-[Test or Prod].crt&quot;</code></p>
<h3 id="2-read-the-documentation">2. Read the documentation</h3>
<p>It is expected that you have a basic understanding of how <a href="https://docs.microsoft.com/en-us/aspnet/core/">ASP.NET</a>, <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/overview">ASP.NET MVC</a> and <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/identity">ASP.NET Authentication</a> works before getting started.</p>
<p>Active Login is designed to make it very easy to get started with BankID, but in the end you are responsible for making sure that you are complient with the technical guidelines and/or legal agreements.</p>
<p>Therefore, before you start using Active Login, please read the documentation relevant to your needs. This will also make sure you understand the concepts better.</p>
<ul>
<li><a href="https://www.bankid.com/utvecklare/guider">BankID (Swedish)</a></li>
<li><a href="https://www.bankid.com/en/utvecklare/guider">BankID (English)</a></li>
</ul>
<h3 id="3-install-the-nuget-package">3. Install the NuGet package</h3>
<p>ActiveLogin.Authentication is distributed as <a href="https://www.nuget.org/profiles/ActiveLogin">packages on NuGet</a>, install using the tool of your choice, for example <em>dotnet cli</em>.</p>
<pre><code class="lang-console">dotnet add package ActiveLogin.Authentication.BankId.AspNetCore
</code></pre>
<h3 id="3-prepare-your-project">3. Prepare your project</h3>
<p>The authentication modules for BankID is registered in your <code>Program.cs</code>. Depending on your setup, you will probably have to configure challenge and callbacks in <code>AccountController.cs</code> or similar.</p>
<p>For the UI to work, it expects there to be a <code>_Layout.cshtml</code> available so that it can render within at <code>@RenderBody()</code>.</p>
<p>The BankID packages have UI that uses classes from <a href="https://getbootstrap.com/">Bootstrap 4</a>, please make sure these styles are available in the <code>_Layout.cshtml</code>.</p>
<p>Our Samples might give you an inspiration on how to do all these.</p>
<h3 id="4-get-started-in-development">4. Get started in development</h3>
<p>BankID requires you to sign an agreement and receive a certificate used to identity you as a company. To get started and try it out the experience there is a simulated environment options available that uses an in-memory implementation. Great for development and testing.</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            .AddDebugEventListener();
            .UseSimulatedEnvironment()
            .AddSameDevice();
    });
</code></pre>
<h3 id="5-use-test-or-production-environments">5. Use test or production environments</h3>
<p>To authenticate using a real BankID you need to receive the certificate. See details under Preperation above.</p>
<p>Samples on how to use them in production are:</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            .AddApplicationInsightsEventListener(options =&gt;
            {
                options.LogUserPersonalIdentityNumberHints = true;
                options.LogCertificateDates = true;
            })
            .UseProductionEnvironment()
            .UseClientCertificateFromAzureKeyVault(configuration.GetSection(&quot;ActiveLogin:BankId:ClientCertificate&quot;))
            .UseRootCaCertificate(Path.Combine(environment.ContentRootPath, configuration.GetValue&lt;string&gt;(&quot;ActiveLogin:BankId:CaCertificate:FilePath&quot;)))
            .AddSameDevice()
            .AddOtherDevice()
            .UseQrCoderQrCodeGenerator()
            .UseUaParserDeviceDetection();
    });
</code></pre>
<p><em><strong>Note:</strong></em> <code>.AddApplicationInsightsEventListener()</code> requires the <a href="https://www.nuget.org/packages/ActiveLogin.Authentication.BankId.AspNetCore.AzureMonitor/">ActiveLogin.Authentication.BankId.AspNetCore.AzureMonitor</a> package.</p>
<p><em><strong>Note:</strong></em> <code>.UseQrCoderQrCodeGenerator()</code> requires the <a href="https://www.nuget.org/packages/ActiveLogin.Authentication.BankId.AspNetCore.QRCoder/">ActiveLogin.Authentication.BankId.AspNetCore.QRCoder</a> package.</p>
<p><em><strong>Note:</strong></em> <code>.UseUaParserDeviceDetection()</code> requires the <a href="https://www.nuget.org/packages/ActiveLogin.Authentication.BankId.AspNetCore.UAParser/">ActiveLogin.Authentication.BankId.AspNetCore.UAParser</a> package.</p>
<h3 id="6-monitoring">6. Monitoring</h3>
<p>Active Login provides a structured way of generating and logging events. These coould be monitored to get statistics and health status of your BankID login method.</p>
<p>Read more on the topic in <a href="monitor.md">Active Login Monitor</a>.</p>
<p><img src="https://alresourcesprod.blob.core.windows.net/docsassets/active-login-monitor-screenshot_1.png" alt="Active Login Monitor"></p>
<hr>
<h2 id="environments">Environments</h2>
<h3 id="simulated-environment">Simulated environment</h3>
<p>For trying out quickly (without the need of certificates) you can use an in-memory implementation of the API by using <code>.UseSimulatedEnvironment()</code>. This could also be good when writing tests.</p>
<h3 id="simulated-environment-with-no-config">Simulated environment with no config</h3>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            .UseSimulatedEnvironment()
            .AddSameDevice()
            ...
    })
</code></pre>
<h3 id="simulated-environment-with-custom-person-info">Simulated environment with custom person info</h3>
<p>The faked name and personal identity number can also be customized like this.</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            .UseSimulatedEnvironment(&quot;Alice&quot;, &quot;Smith&quot;, &quot;199908072391&quot;)
            .AddSameDevice()
            ...
    });
</code></pre>
<h3 id="test-environment">Test environment</h3>
<p>This will use the real REST API for BankID, connecting to the Test environment. It requires you to have the certificates described under <em>Preparation</em> above.</p>
<pre><code class="lang-csharp">services.AddAuthentication()
        .AddBankId(builder =&gt;
    {
        builder
            .UseTestEnvironment()
            .AddSameDevice()
            ...
    });
</code></pre>
<h3 id="production-environment">Production environment</h3>
<p>This will use the real REST API for BankID, connecting to the Production environment. It requires you to have the certificates described under <em>Preparation</em> above.</p>
<pre><code class="lang-csharp">services.AddAuthentication()
        .AddBankId(builder =&gt;
    {
        builder
            .UseProductionEnvironment()
            .AddSameDevice()
            ...
    });
</code></pre>
<h3 id="full-sample-for-production">Full sample for production</h3>
<p>Finally, a full sample on how to use BankID in production with client certificate from Azure KeyVault and trusting a custom root certificate.</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            .UseProductionEnvironment()
            .UseClientCertificateFromAzureKeyVault(configuration.GetSection(&quot;ActiveLogin:BankId:ClientCertificate&quot;))
            .UseRootCaCertificate(Path.Combine(environment.ContentRootPath, configuration.GetValue&lt;string&gt;(&quot;ActiveLogin:BankId:CaCertificate:FilePath&quot;)))
            .AddSameDevice(options =&gt; { })
            .AddOtherDevice(options =&gt; { })
            .UseQrCoderQrCodeGenerator()
            .UseUaParserDeviceDetection();
    });
</code></pre>
<hr>
<h2 id="basic-configuration-samples">Basic configuration samples</h2>
<h3 id="using-client-certificate-from-azure-keyvault">Using client certificate from Azure KeyVault</h3>
<pre><code class="lang-csharp">services.AddAuthentication()
        .AddBankId(builder =&gt;
    {
        builder
            .UseProductionEnvironment()
            .UseClientCertificateFromAzureKeyVault(configuration.GetSection(&quot;ActiveLogin:BankId:ClientCertificate&quot;))
            ...
    });
</code></pre>
<h3 id="using-client-certificate-from-custom-source">Using client certificate from custom source</h3>
<pre><code class="lang-csharp">services.AddAuthentication()
        .AddBankId(builder =&gt;
    {
        builder
            .UseProductionEnvironment()
            .UseClientCertificate(() =&gt; new X509Certificate2( ... ))
            ...
    });
</code></pre>
<h3 id="using-root-ca-certificate">Using root CA certificate</h3>
<p>BankID uses a self signed root ca certificate that you need to trust. This is not possible in all scenarios, like in <a href="https://azure.github.io/AppService/2021/06/22/Root-CA-on-App-Service-Guide.html">Azure App Service</a>. To solve this there is an extension available to trust a custom root certificate using code. It can be used like this.</p>
<pre><code class="lang-csharp">services.AddAuthentication()
        .AddBankId(builder =&gt;
    {
        builder
            .UseProductionEnvironment()
            .UseRootCaCertificate(Path.Combine(environment.ContentRootPath, configuration.GetValue&lt;string&gt;(&quot;ActiveLogin:BankId:CaCertificate:FilePath&quot;)))
            ...
    });
</code></pre>
<h3 id="adding-schemas">Adding schemas</h3>
<ul>
<li><em>Same device</em>: Launches the BankID app on the same device, no need to enter any personal identity number.</li>
<li><em>Other device</em>: The user manually launches the app the smartphone and scans the QR code.</li>
</ul>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            .UseProductionEnvironment()
            ...
            .AddSameDevice()
            .AddOtherDevice();
    });
</code></pre>
<h3 id="customizing-schemas">Customizing schemas</h3>
<p>By default, <code>Add*Device</code> will use predefined schemas and display names, but they can be changed.</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            .UseProductionEnvironment()
            ...
            .AddSameDevice(&quot;custom-auth-scheme&quot;, &quot;Custom display name&quot;, options =&gt; { ... })
            .AddOtherDevice(BankIdDefaults.OtherDeviceAuthenticationScheme, &quot;Custom display name&quot;, options =&gt; { ... });
    });
</code></pre>
<h3 id="custom-schema">Custom schema</h3>
<p>If you want to roll your own, complete custom config, that can be done using <code>.AddCustom()</code>. This is not recomended and in most scenarios not needed.</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            ...
            .AddCustom(options =&gt; {
                options.BankIdAutoLaunch = true;
                options.BankIdAllowChangingPersonalIdentityNumber = false;
            });
    });
</code></pre>
<h3 id="customizing-bankid-options">Customizing BankID options</h3>
<p>BankId options allows you to set and override some options such as these.</p>
<pre><code class="lang-csharp">.AddOtherDevice(options =&gt;
{
    // If the user can use biometric identification such as fingerprint or face recognition
    options.BankIdAllowBiometric = false;

    // Limit possible login methods to, for example, only allow BankID on smartcard.
    options.BankIdCertificatePolicies = BankIdCertificatePolicies.GetPoliciesForProductionEnvironment(...);

    // Issue birthdate claim based on data extracted from the personal identity number
    options.IssueBirthdateClaim = true;

    // Issue gender claim based on data extracted from the personal identity number
    options.IssueGenderClaim = true;

    // Turn off qr code and use personal identity number instead
    options.BankIdUseQrCode = false;
});
</code></pre>
<p>If you want to apply some options for all BankID schemes, you can do so by using <code>.Configure(...)</code>.</p>
<pre><code class="lang-csharp">.Configure(options =&gt;
{
    options.IssueBirthdateClaim = true;
    options.IssueGenderClaim = true;
});
</code></pre>
<hr>
<h2 id="concepts">Concepts</h2>
<h3 id="storing-certificates-in-azure">Storing certificates in Azure</h3>
<p>These are only necessary if you plan to store your certificates in Azure KeyVault (recommended) and use the extension for easy integration with BankID.</p>
<p><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FActiveLogin%2FActiveLogin.Authentication%2Fmain%2Fsamples%2FAzureProvisioningSample%2FActiveLogin.json"><img src="https://azuredeploy.net/deploybutton.png" alt="Deploy to Azure"></a></p>
<ol>
<li>Deploy Azure KeyVault to your subscription. The ARM-template available in <a href="https://github.com/ActiveLogin/ActiveLogin.Authentication/tree/main/samples/AzureProvisioningSample">AzureProvisioningSample</a>  contains configuration that creates a KeyVault and enables <a href="https://azure.microsoft.com/en-us/resources/samples/app-service-msi-keyvault-dotnet/">Managed Service Identity</a> for the App Service.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/key-vault/certificate-scenarios#import-a-certificate">Import the certificates</a> to your Azure Key Vault.</li>
<li>Add the following to your config, the secret identifier and auth settings.</li>
</ol>
<pre><code class="lang-json">{
    &quot;ActiveLogin:BankId:ClientCertificate&quot;: {
        &quot;AzureKeyVaultUri&quot;: &quot;TODO-ADD-YOUR-VALUE&quot;,
        &quot;AzureKeyVaultSecretName&quot;: &quot;TODO-ADD-YOUR-VALUE&quot;
    }
}
</code></pre>
<h4 id="certificates-are-secrets">Certificates are secrets</h4>
<p>When configuring the AzureKeyVaultSecretName, the name is retrieved from the <em>Certificates</em> rather than <em>Secrets</em> in the Azure Portal. It is called a <em>secret</em> in the API since this is how Azure Key Vault exposes certificates with private keys.</p>
<p>You can read more about the reasoning behind this <a href="https://azidentity.azurewebsites.net/post/2018/07/03/azure-key-vault-certificates-are-secrets">in this blog post</a> or in the very extensive <a href="https://docs.microsoft.com/en-gb/azure/key-vault/about-keys-secrets-and-certificates#BKMK_CompositionOfCertificate">official documentation</a>.</p>
<h4 id="keyvault-credentials">KeyVault credentials</h4>
<p>By default, the <code>DefaultAzureCredential</code> will be used as credentials. For info on how to use that, see <a href="https://docs.microsoft.com/en-us/dotnet/api/azure.identity.defaultazurecredential">Microsoft docs</a>. The minimal configuration then looks like this:</p>
<pre><code class="lang-json">{
    &quot;ActiveLogin:BankId:ClientCertificate&quot; {
        &quot;AzureKeyVaultUri&quot;: &quot;TODO-ADD-YOUR-VALUE&quot;,
        &quot;AzureKeyVaultSecretName&quot;: &quot;TODO-ADD-YOUR-VALUE&quot;
    }
}
</code></pre>
<p>You can override the specific managed identity client id to use:</p>
<pre><code class="lang-json">{
    &quot;ActiveLogin:BankId:ClientCertificate&quot; {
        &quot;AzureKeyVaultUri&quot;: &quot;TODO-ADD-YOUR-VALUE&quot;,
        &quot;AzureKeyVaultSecretName&quot;: &quot;TODO-ADD-YOUR-VALUE&quot;,

        &quot;AzureManagedIdentityClientId&quot;: &quot;&quot;
    }
}
</code></pre>
<p>You can also override to use client credentials:</p>
<pre><code class="lang-json">{
    &quot;ActiveLogin:BankId:ClientCertificate&quot; {
        &quot;AzureKeyVaultUri&quot;: &quot;TODO-ADD-YOUR-VALUE&quot;,
        &quot;AzureKeyVaultSecretName&quot;: &quot;TODO-ADD-YOUR-VALUE&quot;,

        &quot;AzureAdTenantId&quot;: &quot;&quot;,
        &quot;AzureAdClientId&quot;: &quot;&quot;,
        &quot;AzureAdClientSecret&quot;: &quot;&quot;
    }
}
</code></pre>
<p>They will be evaluated in the order:</p>
<ol>
<li><code>ClientSecretCredential</code> with <code>AzureAdTenantId</code> + <code>AzureAdClientId</code> + <code>AzureAdClientSecret</code> (if specified)</li>
<li><code>DefaultAzureCredential</code> with <code>AzureManagedIdentityClientId</code> (if specified)</li>
<li><code>DefaultAzureCredential</code></li>
</ol>
<h3 id="bankid-claim-types">BankId claim types</h3>
<p>The claims beeing issued have the names/keys specified in <code>BankIdClaimTypes</code>.</p>
<h3 id="bankid-certificate-policies">BankID Certificate Policies</h3>
<p>BankId options allows you to set a list of certificate policies and there is a class available to help you out with this.</p>
<pre><code class="lang-csharp">.AddOtherDevice(options =&gt;
{
	options.BankIdCertificatePolicies = BankIdCertificatePolicies.GetPoliciesForProductionEnvironment(BankIdCertificatePolicy.BankIdOnFile, BankIdCertificatePolicy.MobileBankId);
});
</code></pre>
<p>Because the policies have different values for test and production environment, you need to use either <code>.GetPoliciesForProductionEnvironment()</code> or <code>.GetPoliciesForTestEnvironment()</code> depending on what environment you are using.</p>
<p>Example:</p>
<pre><code class="lang-csharp">.AddOtherDevice(options =&gt;
{
	var policies = new[] {
            BankIdCertificatePolicy.BankIdOnFile,
            BankIdCertificatePolicy.MobileBankId
        };
	if(isProductionEnvironment) {
		options.BankIdCertificatePolicies = BankIdCertificatePolicies.GetPoliciesForProductionEnvironment(policies);
	} else {
		options.BankIdCertificatePolicies = BankIdCertificatePolicies.GetPoliciesForTestEnvironment(policies);
	}
});
</code></pre>
<h3 id="return-url-for-cancellation">Return URL for cancellation</h3>
<p>If a user cancels the login, the user will be redirected to the <code>cancelReturnUrl</code>.</p>
<p>The defaults for cancellation are as follows:</p>
<ul>
<li>Same Device Scheme returns to scheme selection</li>
<li>Other Device Scheme returns to scheme selection when using QR codes</li>
<li>Other Device Scheme returns to PIN input when using PIN input instead of QR codes</li>
</ul>
<p>It is possible to override the default navigation when cancelling an authentication request. The URL used for navigation is set through the <code>cancelReturnUrl</code> item in the <code>AuthenticationProperties</code> passed in the authentication challenge.</p>
<pre><code class="lang-csharp">var props = new AuthenticationProperties
{
    RedirectUri = Url.Action(nameof(ExternalLoginCallback)),
    Items =
    {
        { &quot;returnUrl&quot;, &quot;~/&quot; },
        { &quot;cancelReturnUrl&quot;, &quot;~/some-custom-cancellation-url&quot; },
        { &quot;scheme&quot;, provider }
    }
};

return Challenge(props, provider);
</code></pre>
<h3 id="handle-missing-or-invalid-state-cookie">Handle missing or invalid state cookie</h3>
<p>If the user navigates directly to the BankdID status page (<em>/BankIdAuthentication/Login</em>) the state cookie (<em>__ActiveLogin.BankIdState</em>) will be missing. If that happens, the flow will fail. By default, the user will be redirected back to the <code>cancelReturnUrl</code>, see <a href="#return-url-for-cancellation">Setting the return URL for cancellation</a>.</p>
<p>This behaviour can be overriden by implementing <code>IBankIdInvalidStateHandler</code> and adding that to the IOC-container.</p>
<p>A simple sample of such handler is:</p>
<pre><code class="lang-csharp">public class SampleInvalidStateHandler : IBankIdInvalidStateHandler
{
    public Task HandleAsync(HttpContext httpContext, BankIdInvalidStateContext invalidStateContext)
    {
        httpContext.Response.StatusCode = StatusCodes.Status500InternalServerError;

        return Task.CompletedTask;
    }
}
</code></pre>
<h3 id="multi-tenant-scenario">Multi tenant scenario</h3>
<p>With the current architecture of Active Login all services are registered &quot;globally&quot; and you can't call <code>.AddBankId()</code> more than once.
To run Active Login in a multi tenant scenario, where different customers should use different certificates, you could register multiple certificates and on runtime select the correct one per request.
With our current solution, this requires you to disable pooling of the <code>SocketsHttpHandler</code> so we've decided not to ship that code in the NuGet-package, but below you'll find a sample on how it could be configured. We hope to redesign this in the future.</p>
<p><em><strong>Note:</strong></em> The code below is a sample and because it disables <code>PooledConnection</code> it might (and will) have performance implications.</p>
<pre><code class="lang-csharp">internal static class BankIdBuilderExtensions
{
    public static IBankIdBuilder UseClientCertificateResolver(this IBankIdBuilder builder, Func&lt;ServiceProvider, X509CertificateCollection, string, X509Certificate&gt; configureClientCertificateResolver)
    {
        builder.ConfigureHttpClientHandler(httpClientHandler =&gt;
        {
            var services = builder.AuthenticationBuilder.Services;
            var serviceProvider = services.BuildServiceProvider();

            httpClientHandler.PooledConnectionLifetime = TimeSpan.Zero;
            httpClientHandler.SslOptions.LocalCertificateSelectionCallback =
                (sender, host, certificates, certificate, issuers) =&gt; configureClientCertificateResolver(serviceProvider, certificates, host);
        });

        return builder;
    }
}

public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        // ...
        services.AddAuthentication()
            .AddBankId(builder =&gt;
            {
                builder
                    .UseClientCertificateFromAzureKeyVault(configuration.GetSection(&quot;ActiveLogin:BankId:ClientCertificate1&quot;))
                    .UseClientCertificateFromAzureKeyVault(configuration.GetSection(&quot;ActiveLogin:BankId:ClientCertificate2&quot;))
                    .UseClientCertificateFromAzureKeyVault(configuration.GetSection(&quot;ActiveLogin:BankId:ClientCertificate3&quot;))
                    .UseClientCertificateResolver((serviceCollection, certificates, hostname) =&gt;
                    {
                        // Apply logic here to select the correct certificate
                        return certificates[0];
                    });

                // ...
            }
    }
}
</code></pre>
<h3 id="customize-the-ui">Customize the UI</h3>
<p>Active Login comes with predefined views that you can use, but maybe you'd rather use your own views to customize layout or behavior.</p>
<p>The UI is bundled into the package as a Razor Class Library, a technique that allows to <a href="https://docs.microsoft.com/en-us/aspnet/core/razor-pages/ui-class?view=aspnetcore-2.1&amp;tabs=visual-studio#override-views-partial-views-and-pages">override the parts you want to customize</a>. The Views and Controllers that can be customized can be found in the <a href="https://github.com/ActiveLogin/ActiveLogin.Authentication/tree/main/src/ActiveLogin.Authentication.BankId.AspNetCore/Areas/BankIdAuthentication">GitHub repo</a>.</p>
<p>To override the default UI your web project, create the following folder:
<code>Areas/BankIdAuthentication/Views/BankId</code></p>
<p>In this folder, you can then create any of the partials and MVC will then discover your partials and use any of them before ours. It's still possible to call our partials if you still want to use them.</p>
<ul>
<li><code>_Login.cshtml</code></li>
<li><code>_LoginForm.cshtml</code></li>
<li><code>_LoginScript.cshtml</code></li>
<li><code>_LoginStatus.cshtml</code></li>
<li><code>_LoginStyle.cshtml</code></li>
</ul>
<p>See <a href="https://github.com/ActiveLogin/ActiveLogin.Authentication/tree/main/samples/Standalone.MvcSample">the MVC sample</a> to see this in action, as demonstrated <a href="https://github.com/ActiveLogin/ActiveLogin.Authentication/tree/main/samples/Standalone.MvcSample/Areas/BankIdAuthentication/Views/BankId/_Login.cshtml">here</a>.</p>
<h3 id="event-listeners">Event listeners</h3>
<p>During the login flow, quite a lot of things are happening and using our event listeners you can listen and act on those events. By implementing and regestering <code>IBankIdEventListener</code> you will be notified when an event occurs. A common scenario is logging. Multiple event listeners can be registered.</p>
<p><code>BankIdEvent</code> is the base class for all events which all events will inherit from. Each event might (and in most cases will) have unique properties relevant for that specific event.</p>
<h4 id="event-types">Event types</h4>
<p>At the moment, we trigger the events listed below. They all have unique event properties relevant to the event type.</p>
<ul>
<li>AspNet
<ul>
<li><code>BankIdAspNetChallengeSuccessEvent</code></li>
<li><code>BankIdAspNetAuthenticateSuccessEvent</code></li>
<li><code>BankIdAspNetAuthenticateFailureEvent</code></li>
</ul>
</li>
<li>Auth
<ul>
<li><code>BankIdAuthSuccessEvent</code></li>
<li><code>BankIdAuthErrorEvent</code></li>
</ul>
</li>
<li>Collect
<ul>
<li><code>BankIdCollectPendingEvent</code></li>
<li><code>BankIdCollectCompletedEvent</code></li>
<li><code>BankIdCollectFailureEvent</code></li>
<li><code>BankIdCollectErrorEvent</code></li>
</ul>
</li>
<li>Cancel
<ul>
<li><code>BankIdCancelSuccessEvent</code></li>
<li><code>BankIdCancelErrorEvent</code></li>
</ul>
</li>
</ul>
<h4 id="sample-implementation">Sample implementation</h4>
<pre><code class="lang-csharp">public class BankIdSampleEventListener : IBankIdEventListener
{
    public Task HandleAsync(BankIdEvent bankIdEvent)
    {
        Console.WriteLine($&quot;{bankIdEvent.EventTypeName}: {bankIdEvent.EventSeverity}&quot;);
        return Task.CompletedTask;
    }
}
</code></pre>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            ...
            .AddEventListener&lt;BankIdSampleEventListener&gt;();
    });
</code></pre>
<h4 id="built-in-event-listeners">Built in event listeners</h4>
<h5 id="bankiddebugeventlistener">BankIdDebugEventListener</h5>
<p><code>BankIdDebugEventListener</code> will listen for all events and write them as serialized JSON to the debug log using <code>ILogger.LogDebug(...)</code>.
Call <code>builder.AddDebugEventListener()</code> to enable it. Good to have for local development to see all details about what is happening.</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            ...
            .AddDebugEventListener();
    });
</code></pre>
<h5 id="bankidapplicationinsightseventlistener">BankIdApplicationInsightsEventListener</h5>
<p><code>BankIdApplicationInsightsEventListener</code> will listen for all events and write them to Application Insights.</p>
<p>Call <code>builder.AddApplicationInsightsEventListener()</code> to enable it. Note that you can supply options to enable logging of metadata, such as personal identity number, age and IP.</p>
<p><em><strong>Note:</strong></em> This event listener is available is available through a separate package called <code>ActiveLogin.Authentication.BankId.AspNetCore.AzureMonitor</code>.</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            ...
            .AddApplicationInsightsEventListener();
    });
</code></pre>
<p>By default it will use whatever InstrumentationKey is registered with the application. There are overloads available so you can customize this:</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            ...
            .AddApplicationInsightsEventListener(&quot;CUSTOM_KEY&quot;);
    });
</code></pre>
<p>You can also customize what kind of data should be logged together with the Application Insight events. For example:</p>
<pre><code class="lang-csharp">services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            ...
            .AddApplicationInsightsEventListener(options =&gt;
            {
                options.LogUserPersonalIdentityNumber = false;
                options.LogUserPersonalIdentityNumberHints = true;

                options.LogUserNames = false;

                options.LogDeviceIpAddress = false;
                options.LogCertificateDates = true;

                // And more...
            });
    });
</code></pre>
<h5 id="bankidloggereventlistener">BankIdLoggerEventListener</h5>
<p><code>BankIdLoggerEventListener</code> will listen for all events and write them with a descriptive text to the log using <code>ILogger.Log(...)</code>.
This listener is registered by default on startup, se info below if you want to clear the default listeners.</p>
<h4 id="default-registered-event-listeners">Default registered event listeners</h4>
<p>By default, two event listeners will be enabled:</p>
<ul>
<li><code>BankIdLoggerEventListener</code> (Log all events to <code>ILogger</code>)</li>
<li><code>BankIdResultStoreEventListener</code> (Map the completion event for <code>IBankIdResultStore</code>, see info below under <strong>Store data on auth completion</strong>.)</li>
</ul>
<p>If you want to remove those implementations, remove any class implementing <code>IBankIdEventListener</code> from the ASP.NET Core services in your <code>Startup.cs</code>:</p>
<pre><code class="lang-csharp">services.RemoveAll(typeof(IBankIdEventListener));
</code></pre>
<h3 id="store-data-on-auth-completion">Store data on auth completion</h3>
<p>When the login flow is completed and the collect request to BankID returns data, any class implementing <code>IBankIdResultStore</code> registered in the DI will be called.
There is a shorthand method (<code>AddResultStore</code>) on the BankIdBuilder to register the implementation.</p>
<p><em><strong>Note:</strong></em> <code>IBankIdResultStore</code> is just a shorthand for the <code>BankIdCollectCompletedEvent</code> as described above.</p>
<p><em>Sample implementation:</em></p>
<pre><code class="lang-csharp">public class BankIdResultSampleLoggerStore : IBankIdResultStore
{
    private readonly EventId _eventId = new EventId(101, &quot;StoreCollectCompletedCompletionData&quot;);
    private readonly ILogger&lt;BankIdResultTraceLoggerStore&gt; _logger;

    public BankIdResultSampleLoggerStore(ILogger&lt;BankIdResultTraceLoggerStore&gt; logger)
    {
        _logger = logger;
    }

    public Task StoreCollectCompletedCompletionData(string orderRef, CompletionData completionData)
    {
        _logger.LogTrace(_eventId, &quot;Storing completion data for OrderRef '{OrderRef}' (UserPersonalIdentityNumber: '{UserPersonalIdentityNumber}')&quot;, orderRef, completionData.User.PersonalIdentityNumber);

        return Task.CompletedTask;
    }
}

services
    .AddAuthentication()
    .AddBankId(builder =&gt;
    {
        builder
            //...
            .AddResultStore&lt;BankIdResultSampleLoggerStore&gt;();
    });
</code></pre>
<p>The default implementation will log all data to the tracelog. If you want to remove that implementation, remove any class implementing <code>IBankIdResultStore</code> from the ASP.NET Core services in your <code>Startup.cs</code>:</p>
<pre><code class="lang-csharp">services.RemoveAll(typeof(IBankIdResultStore));
</code></pre>
<h3 id="resolve-the-end-user-ip">Resolve the end user ip</h3>
<p>In some scenarios, like running behind a proxy, you might want to resolve the end user IP yourself and override the default implementaion.</p>
<p>Either register a class implementing <code>IEndUserIpResolver</code>:</p>
<pre><code class="lang-csharp">builder.UseEndUserIpResolver&lt;EndUserIpResolver&gt;();
</code></pre>
<p>Or use the shorthand version:</p>
<pre><code class="lang-csharp">builder.UseEndUserIpResolver(httpContext =&gt;
{
    return httpContext.Connection.RemoteIpAddress.ToString();
});
</code></pre>
<h3 id="resolve-user-data-on-auth-request">Resolve user data on Auth request</h3>
<p>BankID allows you to display a text during authentication to describe the intent. Active Login allows you to set these parameters when authenticating:</p>
<img src="https://alresourcesprod.blob.core.windows.net/docsassets/active-login-bankid-uservisibledata-screenshot_1.jpg" width="250" alt="User visible data">
<ul>
<li><code>UserVisibleData</code></li>
<li><code>UserNonVisibleData</code></li>
<li><code>UserVisibleDataFormat</code></li>
</ul>
<p>These can either be set as static data during startup in <code>Program.cs</code> or dynamically by overiding the interface <code>IBankIdAuthRequestUserDataResolver</code>.</p>
<p>Sample of static text without formatting:</p>
<pre><code class="lang-csharp">builder.UseAuthRequestUserData(authUserData =&gt;
{
    authUserData.UserVisibleData = &quot;Login to your account at Active Login&quot;;
});
</code></pre>
<p>Sample of static text with formatting:</p>
<pre><code class="lang-csharp">builder.UseAuthRequestUserData(authUserData =&gt;
{
    var message = new StringBuilder();
    message.AppendLine(&quot;# Active Login&quot;);
    message.AppendLine();
    message.AppendLine(&quot;Welcome to the *Active Login* demo.&quot;);

    authUserData.UserVisibleData = message.ToString();
    authUserData.UserVisibleDataFormat = BankIdUserVisibleDataFormats.SimpleMarkdownV1;
});
</code></pre>
<p>For more advanced scenarios, you can generate the user data dynamically by implementing <code>IBankIdAuthRequestUserDataResolver</code>:</p>
<pre><code class="lang-csharp">public class BankIdAuthRequestDynamicUserDataResolver : IBankIdAuthRequestUserDataResolver
{
    public Task&lt;BankIdAuthUserData&gt; GetUserDataAsync(BankIdAuthRequestContext authRequestContext, HttpContext httpContext)
    {
        return Task.FromResult(new BankIdAuthUserData()
        {
            UserVisibleData = &quot;*Time:* &quot; + DateTime.Now.ToLongTimeString(),
            UserVisibleDataFormat = BankIdUserVisibleDataFormats.SimpleMarkdownV1
        });;
    }
}
</code></pre>
<pre><code class="lang-csharp">services.AddTransient&lt;IBankIdAuthRequestUserDataResolver, BankIdAuthRequestDynamicUserDataResolver&gt;();
</code></pre>
<h3 id="custom-qr-code-generation">Custom QR code generation</h3>
<p>By default the <code>ActiveLogin.Authentication.BankId.AspNetCore.Qr</code> package is needed to generate QR codes using the <code>UseQrCoderQrCodeGenerator</code> extension method.</p>
<p>If you wish to provide your own implementation of QR code generation simply implement the <code>IBankIdQrCodeGenerator</code> interface and add your implementation as a service.</p>
<pre><code class="lang-csharp">services.AddTransient&lt;IBankIdQrCodeGenerator, CustomQrCodeGenerator&gt;();
</code></pre>
<h3 id="custom-browser-detection-and-launch-info">Custom browser detection and launch info</h3>
<p>The functionality provided tries to detect the device by looking at the user agent. We need to know what device is used to launch the BankId app and this differs from iOS/Android/PC/Mac.</p>
<p>By implementing <code>IBankIdLauncher</code> you can customize exactly how to launch the app. It is very rare that you need to change this, but could be relevant if you use Active Login for authenticating a user in a native mobile app.</p>
<pre><code class="lang-csharp">services.AddTransient&lt;IBankIdLauncher, CustomBankIdLauncher&gt;();
</code></pre>
<p>By implementing <code>IBankIdSupportedDeviceDetector</code> you can override how the client device is detected. This info will be used by the default BankIdLauncher.</p>
<pre><code class="lang-csharp">services.AddTransient&lt;IBankIdSupportedDeviceDetector, CustomBankIdSupportedDeviceDetector&gt;();
</code></pre>
<h4 id="use-uaparserdevicedetector-for-device-and-browser-detection">Use UAParserDeviceDetector for device and browser detection</h4>
<p>In Active Login device and browser detection is required for example to determine which URL to use to launch the BankID app, according to the BankID Relaying party Guidelines. This logic is primarily encapsulated into <code>IBankIdSupportedDeviceDetector</code>.</p>
<p>The default implementation provided in <code>ActiveLogin.Authentication.BankId.AspNetCore</code> is limited to supports the ~top 5 most common browsers on both iOS and Android. But since an incorrect browser detection can lead to an incorrect launch URL and result in a broken user flow, <code>UAParserDeviceDetector</code> in the <code>ActiveLogin.Authentication.BankId.AspNetCore.UAParser</code> package should be used to support additional browsers. It has a dependency on package <a href="https://github.com/ua-parser/uap-csharp">uap-csharp</a> for improved user agent parsing.</p>
<h3 id="use-api-wrapper-only">Use api wrapper only</h3>
<p>We have seperated the API-wrapper for BankID into a separate package so that you can use it in other scenarios we have not covered. They look like this and are both well documented using XML-comments.</p>
<p>The constructor for these ApiClients takes an <code>HttpClient</code> and you need to configure that <code>HttpClient</code> with a <code>BaseAddress</code>, <code>Tls12</code>, client certificates etc. depending on your needs.</p>
<p><em><strong>Note:</strong></em> The <code>BankIdApiClient</code> class below is available in the <code>ActiveLogin.Authentication.BankId.Api</code> package.</p>
<pre><code class="lang-csharp">public class BankIdApiClient : IBankIdApiClient
{
    public Task&lt;AuthResponse&gt; AuthAsync(AuthRequest request) { ... }
    public Task&lt;SignResponse&gt; SignAsync(SignRequest request) { ... }
    public Task&lt;CollectResponse&gt; CollectAsync(CollectRequest request) { ... }
    public Task&lt;CancelResponse&gt; CancelAsync(CancelRequest request) { ... }
}
</code></pre>
<p><em><strong>Note:</strong></em> The class <code>BankIdUserVisibleDataFormats</code> contains constants for valid values of <code>userVisibleDataFormat</code>, example:</p>
<pre><code class="lang-csharp">    BankIdUserVisibleDataFormats.SimpleMarkdownV1
</code></pre>
<h3 id="running-on-linux">Running on Linux</h3>
<h4 id="certificate-handling-on-linux">Certificate handling on Linux</h4>
<p><code>X509Certificate2</code> can not be handled in the same way when running in Linux as on Windows. The certificate is Base64 encoded and must be decoded before creating the <code>X509Certificate2</code> instance. Below is an example for the BankId root certificate:</p>
<p>Copy the content between Begin certificate and End certificate, and paste it into a resource string in a Resource.resx file.</p>
<p>With the certificate in the reosurce, this code can be used to create the <code>X509Certificate2</code> instance. Note the second line that decodes the Base64 string.</p>
<pre><code class="lang-csharp">var rootCertEncoded = CertificateResources.BankIdRootTestCertificate;
var rootCertBytes = Convert.FromBase64String(rootCertEncoded);

return new X509Certificate2(rootCertBytes, string.Empty, X509KeyStorageFlags.MachineKeySet);
</code></pre>
<h3 id="qrcode-generation-on-linux">QRCode generation on Linux</h3>
<p>The <code>ActiveLogin.Authentication.BankId.AspNetCore.QRCoder</code> package has a dependency on package <a href="https://github.com/mono/libgdiplus">libgdiplus</a> on Linux.</p>
<p>If you are using Active Login with BankID QR-Codes on either WSL (Windows Subsystem for Linux) or in a Linux Docker Container your OS must have this package installed.</p>
<p>Add <a href="https://github.com/mono/libgdiplus">libgdiplus</a> to your Dockerfile using apt-get.</p>
<pre><code class="lang-dockerfile">FROM mcr.microsoft.com/dotnet/core/aspnet:6.0 AS base
RUN apt-get update &amp;&amp; apt-get -y install libgdiplus libc6-dev
...
</code></pre>
<h3 id="localization">Localization</h3>
<p>The messages are already localized to English and Swedish using the official recommended texts. To select what language that is used you can for example use the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/localization#localization-middleware">localization middleware in ASP.NET Core</a>.</p>
<p>The user messages that will be displayed are provided through the implementation of <code>IBankIdUserMessageLocalizer</code>, so by overriding this you can customize the messages.</p>
<pre><code class="lang-csharp">services.AddTransient&lt;IBankIdUserMessageLocalizer, CustomBankIdUserMessageLocalizer&gt;();
</code></pre>
<p>The defualt implementation (<code>BankIdUserMessageStringLocalizer</code>) uses <code>Microsoft.Extensions.Localization.IStringLocalizer</code> and therefore chooses the texts in the <code>*.resx</code> files.</p>
<h3 id="names-of-the-person-might-be-capitalized">Names of the person might be capitalized</h3>
<p>The names comes from the bank that the end user has, and some banks (due to legacy) stores all of the names in all caps (like <code>ALICE SMITH</code>).</p>
<p>We have choosen not to normalize the capitalization of the names as it´s hard or impossible to do so in a general way.</p>
<h3 id="cookies-issued">Cookies issued</h3>
<p>The <code>*.AspNetCore</code> package will issue a cookie to make the auth flow work</p>
<p>The cookie is called: <code>__ActiveLogin.BankIdState</code></p>
<p>The cookie is there to store state during the auth process, as the user will/might be redirected during the flow. The cookie is session based only and will be deleted once the auth process is finished and/or when the user closes the browser.</p>
<p>Because it is strictly related to temp storage during auth, you should not have to inform the user about these specific cookies (according to the <a href="https://www.cookielaw.org/the-cookie-law/">EU &quot;cookie law&quot;</a>).</p>
<p>With the current implementaiton (following the convention from Microsoft ASP.NET) the usage of cookies is not optional.</p>
<p>A more technical deep dive of the cookies can be found in <a href="https://github.com/ActiveLogin/ActiveLogin.Authentication/issues/156">this issue</a>.</p>
<h3 id="browser-support">Browser support</h3>
<p>We aim at supporting the latest version of all major browsers both on desktop and on mobile.</p>
<p>All browsers on mobile are supported to show the UI, but the redirect flow have been tested and verified on these:</p>
<ul>
<li>iOS
<ul>
<li>Safari</li>
<li>Chrome</li>
<li>Edge</li>
<li>Firefox</li>
<li>Opera Touch</li>
</ul>
</li>
<li>Android
<ul>
<li>Chrome</li>
<li>Firefox</li>
<li>Edge</li>
<li>Samsung Internet</li>
<li>Opera Mini</li>
</ul>
</li>
</ul>
<p><em><strong>Note:</strong></em> Brave on iOS/Android identifies as Safari or Chrome for privacy reasons and will get wrong configuration, so the redirect flow will fail.</p>
<p><em><strong>Note:</strong></em> If you aim to support IE11 a polyfill for some JavaScript features we are using is needed.</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch</a>: <a href="https://github.com/github/fetch">https://github.com/github/fetch</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/joanro123/DocFx_Example/blob/master/docs/articles/bankid.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
